
## 数据库操作常见问题

### 1、`and` 、`or`、`in`、`nin`、`neq`的用法
### 针对同一个字段的 `and` 和 `or`
```js
// num >=0 and num <= 10
// 流式简写法
num : _.gte(0).lte(10)  
// 流式完整写法
num : _.gte(0).and(_.lte(10))  
// 前置写法
num : _.and(_.gte(0), _.lte(10))

// num <=0 or num >= 10
// 前置写法
num : _.or(_.lte(0), _.gte(10))
// 流式写法
num : _.lte(0).or(_.gte(10))

// num <=0 or (num > 10 or num <20)
// 流式写法(复式)
num : _.lte(0).or(_.gt(10).and(_.lt(20)))

```
### 跨字段的 `and` 和 `or`
```js
// num >50 and name = 'test'
whereJson: _.and([
  {
    num: _.gt(50)
  },
  {
    name: 'test'
  }
])

// num >50 or name = 'test'
whereJson: _.or([
  {
    num: _.gt(50)
  },
  {
    name: 'test'
  }
])


// num >50 and (name = 'test' or sex = 1)
whereJson: _.and([
  {
    num: _.gt(50)
  },
  _.or([
    {
      name: 'test'
    },
    {
      sex: 1
    }
  ])
])

```
### in （包含其中） `nin`（都不包含）
```js
// num in(1,2,3) 等价于 num = 1 or num = 2 or num = 3
num : _.in([1,2,3])
// num nin(1,2,3) 等价于 num != 1 and num !== 2 and num != 3
num : _.nin([1,2,3])

```

### `neq` (不等于）
```js
// num != 1
num : _.neq(1)


```

### 2、如何控制只获取部分字段
#### 只取 `username` 和 `nickname`
```js
let selectRes = await vk.baseDao.select({
  dbName:"uni-id-users",
  pageIndex:1,
  pageSize:20,
  fieldJson:{
    username:true, 
    nickname:true
  }
});
```

#### 除了 `token` 和 `password` 其他都取
```js
let selectRes = await vk.baseDao.select({
  dbName:"uni-id-users",
  pageIndex:1,
  pageSize:20,
  fieldJson:{
    token:false, 
    password:false 
  }
});
```

### 3、排序
#### 升序
```js
// 按注册时间升序
let selectRes = await vk.baseDao.select({
  dbName:"uni-id-users",
  pageIndex:1,
  pageSize:20,
  sortArr:[{ "name":"register_date", "type":"asc" }]
});
```

#### 降序
```js
// 按注册时间降序
let selectRes = await vk.baseDao.select({
  dbName:"uni-id-users",
  pageIndex:1,
  pageSize:20,
  sortArr:[{ "name":"register_date", "type":"desc" }]
});
```
#### 多个排序条件
```js
// 按注册时间降序，时间相同者按_id 降序
let selectRes = await vk.baseDao.select({
  dbName:"uni-id-users",
  pageIndex:1,
  pageSize:20,
  sortArr:[
    { "name":"register_date", "type":"desc" },
    { "name":"_id", "type":"desc" }
  ]
});
```

### 4、模糊查询
#### 以`xxxx`开头
```js
let selectRes = await vk.baseDao.select({
  dbName:"uni-id-users",
  pageIndex:1,
  pageSize:20,
  whereJson:{
    nickname : new RegExp('^'+searchvalue)
  }
});
```

#### 以`xxxx`结尾
```js
let selectRes = await vk.baseDao.select({
  dbName:"uni-id-users",
  pageIndex:1,
  pageSize:20,
  whereJson:{
    nickname : new RegExp(searchvalue+'$')
  }
});
```
#### 包含`xxxx`
```js
let selectRes = await vk.baseDao.select({
  dbName:"uni-id-users",
  pageIndex:1,
  pageSize:20,
  whereJson:{
    nickname : new RegExp(searchvalue)
  }
});
```

### 5、如何判断字段是否存在
```js
let selectRes = await vk.baseDao.select({
  dbName:"uni-id-users",
  pageIndex:1,
  pageSize:20,
  whereJson:{
    nickname : _.exists(true), // true：存在 false：不存在
  }
});

```
